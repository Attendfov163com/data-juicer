2024-12-05 14:23:33.256 | INFO     | data_juicer.config.config:config_backup:646 - Back up the input config file [/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/HumanCentricVideoAnnotationPipeline/process.yaml] into the work_dir [/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow]
2024-12-05 14:23:33.298 | INFO     | data_juicer.config.config:display_config:668 - Configuration table: 
╒════════════════════════════╤═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╕
│ key                        │ values                                                                                                                                            │
╞════════════════════════════╪═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╡
│ config                     │ [Path_fr(/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/HumanCentricVideoAnnotationPipeline/process.yaml)]                                        │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ hpo_config                 │ None                                                                                                                                              │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ path_k_sigma_recipe        │ None                                                                                                                                              │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ path_model_feedback_recipe │ None                                                                                                                                              │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ model_infer_config         │ None                                                                                                                                              │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ model_train_config         │ None                                                                                                                                              │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ data_eval_config           │ None                                                                                                                                              │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ model_eval_config          │ None                                                                                                                                              │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ data_probe_algo            │ 'uniform'                                                                                                                                         │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ data_probe_ratio           │ 1.0                                                                                                                                               │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ project_name               │ 'all'                                                                                                                                             │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ executor_type              │ 'default'                                                                                                                                         │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ dataset_path               │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow/raw_videos_prcocess6.jsonl'                                                       │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_path                │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow/raw_videos_prcocess7.jsonl'                                                       │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_shard_size          │ 0                                                                                                                                                 │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_in_parallel         │ False                                                                                                                                             │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ keep_stats_in_res_ds       │ False                                                                                                                                             │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ keep_hashes_in_res_ds      │ False                                                                                                                                             │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ np                         │ 1                                                                                                                                                 │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ text_keys                  │ 'text'                                                                                                                                            │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ image_key                  │ 'images'                                                                                                                                          │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ image_special_token        │ '<__dj__image>'                                                                                                                                   │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ audio_key                  │ 'audios'                                                                                                                                          │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ audio_special_token        │ '<__dj__audio>'                                                                                                                                   │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ video_key                  │ 'videos'                                                                                                                                          │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ video_special_token        │ '<__dj__video>'                                                                                                                                   │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ eoc_special_token          │ '<|__dj__eoc|>'                                                                                                                                   │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ suffixes                   │ []                                                                                                                                                │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ use_cache                  │ True                                                                                                                                              │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ ds_cache_dir               │ '/home/daoyuan_mm/.cache/huggingface/datasets'                                                                                                    │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ cache_compress             │ None                                                                                                                                              │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ use_checkpoint             │ False                                                                                                                                             │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ temp_dir                   │ None                                                                                                                                              │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ open_tracer                │ False                                                                                                                                             │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ op_list_to_trace           │ []                                                                                                                                                │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ trace_num                  │ 10                                                                                                                                                │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ op_fusion                  │ False                                                                                                                                             │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ process                    │ [{'video_captioning_from_human_tracks_mapper': {'accelerator': 'cpu',                                                                             │
│                            │                                                 'audio_key': 'audios',                                                                            │
│                            │                                                 'batched_op': False,                                                                              │
│                            │                                                 'cpu_required': 1,                                                                                │
│                            │                                                 'human_track_query': 'Descibe '                                                                   │
│                            │                                                                      'the '                                                                       │
│                            │                                                                      "person's "                                                                  │
│                            │                                                                      'apperance. ',                                                               │
│                            │                                                 'image_key': 'images',                                                                            │
│                            │                                                 'mem_required': '35GB',                                                                           │
│                            │                                                 'num_proc': 0,                                                                                    │
│                            │                                                 'tempt_video_path': '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_tmpt',                     │
│                            │                                                 'text_key': 'text',                                                                               │
│                            │                                                 'use_actor': False,                                                                               │
│                            │                                                 'video_describe_model_path': '/mnt/daoyuan_open_research/zt_data/pt_model/sharegpt4video-8b',     │
│                            │                                                 'video_key': 'videos'}},                                                                          │
│                            │  {'video_captioning_face_attribute_emotion_mapper': {'accelerator': 'cpu',                                                                        │
│                            │                                                      'audio_key': 'audios',                                                                       │
│                            │                                                      'batched_op': False,                                                                         │
│                            │                                                      'cpu_required': 1,                                                                           │
│                            │                                                      'cropping_face_video_tempt_path': '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_tmpt',  │
│                            │                                                      'face_track_query': 'Please '                                                                │
│                            │                                                                          'only '                                                                  │
│                            │                                                                          'describe '                                                              │
│                            │                                                                          'the '                                                                   │
│                            │                                                                          'appearance '                                                            │
│                            │                                                                          'and '                                                                   │
│                            │                                                                          'facial '                                                                │
│                            │                                                                          'emotions '                                                              │
│                            │                                                                          'of '                                                                    │
│                            │                                                                          'the '                                                                   │
│                            │                                                                          'person '                                                                │
│                            │                                                                          'in '                                                                    │
│                            │                                                                          'the '                                                                   │
│                            │                                                                          'video '                                                                 │
│                            │                                                                          'in '                                                                    │
│                            │                                                                          'detail. '                                                               │
│                            │                                                                          "Don't "                                                                 │
│                            │                                                                          'mention '                                                               │
│                            │                                                                          'the '                                                                   │
│                            │                                                                          'background. '                                                           │
│                            │                                                                          'Less '                                                                  │
│                            │                                                                          'than '                                                                  │
│                            │                                                                          '80 '                                                                    │
│                            │                                                                          'words.',                                                                │
│                            │                                                      'image_key': 'images',                                                                       │
│                            │                                                      'mem_required': '35GB',                                                                      │
│                            │                                                      'num_proc': 0,                                                                               │
│                            │                                                      'text_key': 'text',                                                                          │
│                            │                                                      'use_actor': False,                                                                          │
│                            │                                                      'video_describe_model_path': '/mnt2/daoyuan_open_research/daoyuan_mm/zt_data/video_MLLM_pt', │
│                            │                                                      'video_key': 'videos'}}]                                                                     │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ percentiles                │ []                                                                                                                                                │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_original_dataset    │ False                                                                                                                                             │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ save_stats_in_one_file     │ False                                                                                                                                             │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ ray_address                │ 'auto'                                                                                                                                            │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ debug                      │ False                                                                                                                                             │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ work_dir                   │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow'                                                                                  │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ timestamp                  │ '20241205142330'                                                                                                                                  │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ dataset_dir                │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow'                                                                                  │
├────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ add_suffix                 │ False                                                                                                                                             │
╘════════════════════════════╧═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╛
2024-12-05 14:23:33.299 | INFO     | data_juicer.core.executor:__init__:49 - Using cache compression method: [None]
2024-12-05 14:23:33.299 | INFO     | data_juicer.core.executor:__init__:54 - Setting up data formatter...
2024-12-05 14:23:33.300 | INFO     | data_juicer.core.executor:__init__:76 - Preparing exporter...
2024-12-05 14:23:33.300 | INFO     | data_juicer.core.executor:run:153 - Loading dataset from data formatter...
2024-12-05 14:23:34.043 | INFO     | data_juicer.format.formatter:unify_format:185 - Unifying the input dataset formats...
2024-12-05 14:23:34.045 | INFO     | data_juicer.format.formatter:unify_format:200 - There are 3 sample(s) in the original dataset.
2024-12-05 14:23:34.053 | INFO     | data_juicer.format.formatter:unify_format:214 - 3 samples left after filtering empty text.
2024-12-05 14:23:34.056 | INFO     | data_juicer.format.formatter:unify_format:237 - Converting relative paths in the dataset to their absolute version. (Based on the directory of input dataset file)
2024-12-05 14:23:34.063 | INFO     | data_juicer.format.mixture_formatter:load_dataset:137 - sampled 3 from 3
2024-12-05 14:23:34.077 | INFO     | data_juicer.format.mixture_formatter:load_dataset:143 - There are 3 in final dataset
2024-12-05 14:23:34.077 | INFO     | data_juicer.core.executor:run:159 - Preparing process operators...
2024-12-05 14:23:34.077 | INFO     | data_juicer.utils.model_utils:prepare_sharegpt4video_model:697 - Loading sharegpt4video model...
Load vision tower from openai/clip-vit-large-patch14-336
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|##5       | 1/4 [00:00<00:01,  2.66it/s]Loading checkpoint shards:  50%|#####     | 2/4 [00:00<00:00,  3.17it/s]Loading checkpoint shards:  75%|#######5  | 3/4 [00:00<00:00,  3.20it/s]Loading checkpoint shards: 100%|##########| 4/4 [00:01<00:00,  3.08it/s]Loading checkpoint shards: 100%|##########| 4/4 [00:01<00:00,  3.07it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|##5       | 1/4 [00:02<00:06,  2.28s/it]Loading checkpoint shards:  50%|#####     | 2/4 [00:04<00:04,  2.33s/it]Loading checkpoint shards:  75%|#######5  | 3/4 [00:06<00:02,  2.21s/it]Loading checkpoint shards: 100%|##########| 4/4 [00:07<00:00,  1.75s/it]Loading checkpoint shards: 100%|##########| 4/4 [00:07<00:00,  1.94s/it]
2024-12-05 14:23:46.538 | INFO     | data_juicer.core.executor:run:166 - Processing data...
2024-12-05 14:23:46.662 | INFO     | data_juicer.core.executor:run:255 - Op [video_captioning_from_human_tracks_mapper] Done in 0.124(s). Left 3 samples.
video_captioning_face_attribute_emotion_mapper_process:   0%|          | 0/3 [00:00<?, ? examples/s]2024-12-05 14:23:46.771 | INFO     | data_juicer.utils.model_utils:move_to_cuda:770 - Moving Videollama2Qwen2ForCausalLM to CUDA device 0
video_captioning_face_attribute_emotion_mapper_process:  33%|###3      | 1/3 [00:13<00:26, 13.39s/ examples]2024-12-05 14:24:00.154 | INFO     | data_juicer.utils.model_utils:move_to_cuda:770 - Moving Videollama2Qwen2ForCausalLM to CUDA device 0
video_captioning_face_attribute_emotion_mapper_process:  67%|######6   | 2/3 [00:15<00:06,  6.82s/ examples]2024-12-05 14:24:02.383 | INFO     | data_juicer.utils.model_utils:move_to_cuda:770 - Moving Videollama2Qwen2ForCausalLM to CUDA device 0
video_captioning_face_attribute_emotion_mapper_process: 100%|##########| 3/3 [00:21<00:00,  6.29s/ examples]video_captioning_face_attribute_emotion_mapper_process: 100%|##########| 3/3 [00:21<00:00,  7.09s/ examples]
2024-12-05 14:24:08.042 | INFO     | data_juicer.core.executor:run:255 - Op [video_captioning_face_attribute_emotion_mapper] Done in 21.380(s). Left 3 samples.
2024-12-05 14:24:08.042 | INFO     | data_juicer.core.executor:run:259 - All Ops are done in 21.504(s).
2024-12-05 14:24:08.043 | INFO     | data_juicer.core.executor:run:262 - Exporting dataset to disk...
2024-12-05 14:24:08.058 | INFO     | data_juicer.core.exporter:_export_impl:140 - Export dataset into a single file...
Creating json from Arrow format:   0%|          | 0/1 [00:00<?, ?ba/s]Creating json from Arrow format: 100%|##########| 1/1 [00:00<00:00, 113.14ba/s]
