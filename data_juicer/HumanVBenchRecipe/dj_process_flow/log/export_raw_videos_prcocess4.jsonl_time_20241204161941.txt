2024-12-04 16:19:44.299 | INFO     | data_juicer.config.config:config_backup:646 - Back up the input config file [/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/HumanCentricVideoAnnotationPipeline/process.yaml] into the work_dir [/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow]
2024-12-04 16:19:44.336 | INFO     | data_juicer.config.config:display_config:668 - Configuration table: 
╒════════════════════════════╤════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╕
│ key                        │ values                                                                                                                                                 │
╞════════════════════════════╪════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╡
│ config                     │ [Path_fr(/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/HumanCentricVideoAnnotationPipeline/process.yaml)]                                             │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ hpo_config                 │ None                                                                                                                                                   │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ path_k_sigma_recipe        │ None                                                                                                                                                   │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ path_model_feedback_recipe │ None                                                                                                                                                   │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ model_infer_config         │ None                                                                                                                                                   │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ model_train_config         │ None                                                                                                                                                   │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ data_eval_config           │ None                                                                                                                                                   │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ model_eval_config          │ None                                                                                                                                                   │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ data_probe_algo            │ 'uniform'                                                                                                                                              │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ data_probe_ratio           │ 1.0                                                                                                                                                    │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ project_name               │ 'all'                                                                                                                                                  │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ executor_type              │ 'default'                                                                                                                                              │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ dataset_path               │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow/raw_videos_prcocess3.jsonl'                                                            │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_path                │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow/raw_videos_prcocess4.jsonl'                                                            │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_shard_size          │ 0                                                                                                                                                      │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_in_parallel         │ False                                                                                                                                                  │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ keep_stats_in_res_ds       │ False                                                                                                                                                  │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ keep_hashes_in_res_ds      │ False                                                                                                                                                  │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ np                         │ 1                                                                                                                                                      │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ text_keys                  │ 'text'                                                                                                                                                 │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ image_key                  │ 'images'                                                                                                                                               │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ image_special_token        │ '<__dj__image>'                                                                                                                                        │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ audio_key                  │ 'audios'                                                                                                                                               │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ audio_special_token        │ '<__dj__audio>'                                                                                                                                        │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ video_key                  │ 'videos'                                                                                                                                               │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ video_special_token        │ '<__dj__video>'                                                                                                                                        │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ eoc_special_token          │ '<|__dj__eoc|>'                                                                                                                                        │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ suffixes                   │ []                                                                                                                                                     │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ use_cache                  │ True                                                                                                                                                   │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ ds_cache_dir               │ '/home/daoyuan_mm/.cache/huggingface/datasets'                                                                                                         │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ cache_compress             │ None                                                                                                                                                   │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ use_checkpoint             │ False                                                                                                                                                  │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ temp_dir                   │ None                                                                                                                                                   │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ open_tracer                │ False                                                                                                                                                  │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ op_list_to_trace           │ []                                                                                                                                                     │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ trace_num                  │ 10                                                                                                                                                     │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ op_fusion                  │ False                                                                                                                                                  │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ process                    │ [{'video_captioning_face_attribute_demographic_mapper': {'accelerator': 'cpu',                                                                         │
│                            │                                                          'audio_key': 'audios',                                                                        │
│                            │                                                          'batched_op': False,                                                                          │
│                            │                                                          'cpu_required': 1,                                                                            │
│                            │                                                          'detect_interval': 5,                                                                         │
│                            │                                                          'image_key': 'images',                                                                        │
│                            │                                                          'mem_required': 0,                                                                            │
│                            │                                                          'num_proc': 0,                                                                                │
│                            │                                                          'original_data_save_path': '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_faceattribute', │
│                            │                                                          'text_key': 'text',                                                                           │
│                            │                                                          'use_actor': False,                                                                           │
│                            │                                                          'video_key': 'videos'}}]                                                                      │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ percentiles                │ []                                                                                                                                                     │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_original_dataset    │ False                                                                                                                                                  │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ save_stats_in_one_file     │ False                                                                                                                                                  │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ ray_address                │ 'auto'                                                                                                                                                 │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ debug                      │ False                                                                                                                                                  │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ work_dir                   │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow'                                                                                       │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ timestamp                  │ '20241204161941'                                                                                                                                       │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ dataset_dir                │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow'                                                                                       │
├────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ add_suffix                 │ False                                                                                                                                                  │
╘════════════════════════════╧════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╛
2024-12-04 16:19:44.337 | INFO     | data_juicer.core.executor:__init__:49 - Using cache compression method: [None]
2024-12-04 16:19:44.337 | INFO     | data_juicer.core.executor:__init__:54 - Setting up data formatter...
2024-12-04 16:19:44.338 | INFO     | data_juicer.core.executor:__init__:76 - Preparing exporter...
2024-12-04 16:19:44.338 | INFO     | data_juicer.core.executor:run:153 - Loading dataset from data formatter...
2024-12-04 16:19:45.403 | INFO     | data_juicer.format.formatter:unify_format:185 - Unifying the input dataset formats...
2024-12-04 16:19:45.404 | INFO     | data_juicer.format.formatter:unify_format:200 - There are 3 sample(s) in the original dataset.
2024-12-04 16:19:45.411 | INFO     | data_juicer.format.formatter:unify_format:214 - 3 samples left after filtering empty text.
2024-12-04 16:19:45.412 | INFO     | data_juicer.format.formatter:unify_format:237 - Converting relative paths in the dataset to their absolute version. (Based on the directory of input dataset file)
2024-12-04 16:19:45.418 | INFO     | data_juicer.format.mixture_formatter:load_dataset:137 - sampled 3 from 3
2024-12-04 16:19:45.425 | INFO     | data_juicer.format.mixture_formatter:load_dataset:143 - There are 3 in final dataset
2024-12-04 16:19:45.425 | INFO     | data_juicer.core.executor:run:159 - Preparing process operators...
2024-12-04 16:19:45.425 | INFO     | data_juicer.core.executor:run:166 - Processing data...
video_captioning_face_attribute_demographic_mapper_process:   0%|          | 0/3 [00:00<?, ? examples/s]
Finding actions:   0%|          | 0/3 [00:00<?, ?it/s][A
Action: age:   0%|          | 0/3 [00:00<?, ?it/s]    [A24-12-04 16:21:23 - age_model_weights.h5 will be downloaded...
Action: age:   0%|          | 0/3 [03:47<?, ?it/s]
video_captioning_face_attribute_demographic_mapper_process:   0%|          | 0/3 [03:48<?, ? examples/s]video_captioning_face_attribute_demographic_mapper_process:   0%|          | 0/3 [03:48<?, ? examples/s]
2024-12-04 16:23:33.998 | ERROR    | data_juicer.core.executor:run:240 - An error occurred during Op [video_captioning_face_attribute_demographic_mapper].
Traceback (most recent call last):
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/connection.py", line 196, in _new_conn
    sock = connection.create_connection(
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
TimeoutError: [Errno 110] Connection timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/connectionpool.py", line 789, in urlopen
    response = self._make_request(
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/connectionpool.py", line 490, in _make_request
    raise new_e
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/connectionpool.py", line 466, in _make_request
    self._validate_conn(conn)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/connectionpool.py", line 1095, in _validate_conn
    conn.connect()
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/connection.py", line 615, in connect
    self.sock = sock = self._new_conn()
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/connection.py", line 211, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPSConnection object at 0x7f4d40fb90d0>: Failed to establish a new connection: [Errno 110] Connection timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/requests/adapters.py", line 486, in send
    resp = conn.urlopen(
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/connectionpool.py", line 843, in urlopen
    retries = retries.increment(
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='github.com', port=443): Max retries exceeded with url: /serengil/deepface_models/releases/download/v1.0/age_model_weights.h5 (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f4d40fb90d0>: Failed to establish a new connection: [Errno 110] Connection timed out'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/daoyuan_mm/data_juicer/data_juicer/core/executor.py", line 181, in run
    tmp = dataset.map(function=op.process,
  File "/home/daoyuan_mm/data_juicer/data_juicer/core/data.py", line 180, in map
    new_ds = NestedDataset(super().map(*args, **kargs))
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/datasets/arrow_dataset.py", line 593, in wrapper
    out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/datasets/arrow_dataset.py", line 558, in wrapper
    out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/datasets/arrow_dataset.py", line 3105, in map
    for rank, done, content in Dataset._map_single(**dataset_kwargs):
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/datasets/arrow_dataset.py", line 3458, in _map_single
    example = apply_function_on_filtered_inputs(example, i, offset=offset)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/datasets/arrow_dataset.py", line 3361, in apply_function_on_filtered_inputs
    processed_inputs = function(*fn_args, *additional_args, **fn_kwargs)
  File "/home/daoyuan_mm/data_juicer/data_juicer/core/data.py", line 47, in wrapped_f
    return f(*args, **kargs)
  File "/home/daoyuan_mm/data_juicer/data_juicer/core/data.py", line 47, in wrapped_f
    return f(*args, **kargs)
  File "/home/daoyuan_mm/data_juicer/data_juicer/ops/mapper/video_captioning_face_attribute_demographic_mapper.py", line 119, in process
    face_message = DeepFace.analyze(
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/deepface/DeepFace.py", line 247, in analyze
    return demography.analyze(
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/deepface/modules/demography.py", line 172, in analyze
    apparent_age = modeling.build_model("Age").predict(img_content)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/deepface/modules/modeling.py", line 59, in build_model
    model_obj[model_name] = model()
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/deepface/extendedmodels/Age.py", line 32, in __init__
    self.model = load_model()
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/deepface/extendedmodels/Age.py", line 74, in load_model
    gdown.download(url, output, quiet=False)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/gdown/download.py", line 188, in download
    res = sess.get(url, stream=True, verify=verify)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/requests/adapters.py", line 519, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPSConnectionPool(host='github.com', port=443): Max retries exceeded with url: /serengil/deepface_models/releases/download/v1.0/age_model_weights.h5 (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f4d40fb90d0>: Failed to establish a new connection: [Errno 110] Connection timed out'))
