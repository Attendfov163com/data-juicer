2024-12-05 14:50:45.299 | INFO     | data_juicer.config.config:config_backup:646 - Back up the input config file [/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/HumanCentricVideoAnnotationPipeline/process.yaml] into the work_dir [/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow]
2024-12-05 14:50:45.336 | INFO     | data_juicer.config.config:display_config:668 - Configuration table: 
╒════════════════════════════╤═════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╕
│ key                        │ values                                                                                                                  │
╞════════════════════════════╪═════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╡
│ config                     │ [Path_fr(/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/HumanCentricVideoAnnotationPipeline/process.yaml)]              │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ hpo_config                 │ None                                                                                                                    │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ path_k_sigma_recipe        │ None                                                                                                                    │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ path_model_feedback_recipe │ None                                                                                                                    │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ model_infer_config         │ None                                                                                                                    │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ model_train_config         │ None                                                                                                                    │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ data_eval_config           │ None                                                                                                                    │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ model_eval_config          │ None                                                                                                                    │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ data_probe_algo            │ 'uniform'                                                                                                               │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ data_probe_ratio           │ 1.0                                                                                                                     │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ project_name               │ 'all'                                                                                                                   │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ executor_type              │ 'default'                                                                                                               │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ dataset_path               │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow/raw_videos_prcocess7.jsonl'                             │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_path                │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow/raw_videos_prcocess8.jsonl'                             │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_shard_size          │ 0                                                                                                                       │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_in_parallel         │ False                                                                                                                   │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ keep_stats_in_res_ds       │ False                                                                                                                   │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ keep_hashes_in_res_ds      │ False                                                                                                                   │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ np                         │ 1                                                                                                                       │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ text_keys                  │ 'text'                                                                                                                  │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ image_key                  │ 'images'                                                                                                                │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ image_special_token        │ '<__dj__image>'                                                                                                         │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ audio_key                  │ 'audios'                                                                                                                │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ audio_special_token        │ '<__dj__audio>'                                                                                                         │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ video_key                  │ 'videos'                                                                                                                │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ video_special_token        │ '<__dj__video>'                                                                                                         │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ eoc_special_token          │ '<|__dj__eoc|>'                                                                                                         │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ suffixes                   │ []                                                                                                                      │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ use_cache                  │ True                                                                                                                    │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ ds_cache_dir               │ '/home/daoyuan_mm/.cache/huggingface/datasets'                                                                          │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ cache_compress             │ None                                                                                                                    │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ use_checkpoint             │ False                                                                                                                   │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ temp_dir                   │ None                                                                                                                    │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ open_tracer                │ False                                                                                                                   │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ op_list_to_trace           │ []                                                                                                                      │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ trace_num                  │ 10                                                                                                                      │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ op_fusion                  │ False                                                                                                                   │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ process                    │ [{'video_audio_speech_ASR_mapper': {'accelerator': 'cpu',                                                               │
│                            │                                     'audio_key': 'audios',                                                              │
│                            │                                     'batched_op': False,                                                                │
│                            │                                     'cpu_required': 1,                                                                  │
│                            │                                     'image_key': 'images',                                                              │
│                            │                                     'mem_required': '20GB',                                                             │
│                            │                                     'model_dir_ASR_emo': '/mnt/daoyuan_open_research/zt_data/pt_model/SenseVoiceSmall', │
│                            │                                     'num_proc': 0,                                                                      │
│                            │                                     'text_key': 'text',                                                                 │
│                            │                                     'use_actor': False,                                                                 │
│                            │                                     'video_key': 'videos'}}]                                                            │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ percentiles                │ []                                                                                                                      │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_original_dataset    │ False                                                                                                                   │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ save_stats_in_one_file     │ False                                                                                                                   │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ ray_address                │ 'auto'                                                                                                                  │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ debug                      │ False                                                                                                                   │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ work_dir                   │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow'                                                        │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ timestamp                  │ '20241205145042'                                                                                                        │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ dataset_dir                │ '/home/daoyuan_mm/data_juicer/HumanVBenchRecipe/dj_process_flow'                                                        │
├────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ add_suffix                 │ False                                                                                                                   │
╘════════════════════════════╧═════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╛
2024-12-05 14:50:45.337 | INFO     | data_juicer.core.executor:__init__:49 - Using cache compression method: [None]
2024-12-05 14:50:45.337 | INFO     | data_juicer.core.executor:__init__:54 - Setting up data formatter...
2024-12-05 14:50:45.338 | INFO     | data_juicer.core.executor:__init__:76 - Preparing exporter...
2024-12-05 14:50:45.338 | INFO     | data_juicer.core.executor:run:153 - Loading dataset from data formatter...
2024-12-05 14:50:46.223 | INFO     | data_juicer.format.formatter:unify_format:185 - Unifying the input dataset formats...
2024-12-05 14:50:46.225 | INFO     | data_juicer.format.formatter:unify_format:200 - There are 3 sample(s) in the original dataset.
2024-12-05 14:50:46.233 | INFO     | data_juicer.format.formatter:unify_format:214 - 3 samples left after filtering empty text.
2024-12-05 14:50:46.237 | INFO     | data_juicer.format.formatter:unify_format:237 - Converting relative paths in the dataset to their absolute version. (Based on the directory of input dataset file)
2024-12-05 14:50:46.245 | INFO     | data_juicer.format.mixture_formatter:load_dataset:137 - sampled 3 from 3
2024-12-05 14:50:46.262 | INFO     | data_juicer.format.mixture_formatter:load_dataset:143 - There are 3 in final dataset
2024-12-05 14:50:46.263 | INFO     | data_juicer.core.executor:run:159 - Preparing process operators...
2024-12-05 14:50:46.263 | INFO     | data_juicer.utils.model_utils:prepare_SenseVoiceSmall_model:678 - Loading ASR_Emo_model model...
Detect model requirements, begin to install it: /mnt/daoyuan_open_research/zt_data/pt_model/SenseVoiceSmall/requirements.txt
fail to install model requirements! 
error 
[notice] A new release of pip is available: 24.2 -> 24.3.1
[notice] To update, run: pip install --upgrade pip
ERROR: Exception:
Traceback (most recent call last):
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/urllib3/response.py", line 438, in _error_catcher
    yield
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/urllib3/response.py", line 561, in read
    data = self._fp_read(amt) if not fp_closed else b""
           ^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/urllib3/response.py", line 527, in _fp_read
    return self._fp.read(amt) if amt is not None else self._fp.read()
           ^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/cachecontrol/filewrapper.py", line 98, in read
    data: bytes = self.__fp.read(amt)
                  ^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/http/client.py", line 479, in read
    s = self.fp.read(amt)
        ^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/socket.py", line 708, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/ssl.py", line 1252, in recv_into
    return self.read(nbytes, buffer)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/ssl.py", line 1104, in read
    return self._sslobj.read(len, buffer)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: The read operation timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/cli/base_command.py", line 105, in _run_wrapper
    status = _inner_run()
             ^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/cli/base_command.py", line 96, in _inner_run
    return self.run(options, args)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/cli/req_command.py", line 67, in wrapper
    return func(self, options, args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/commands/install.py", line 379, in run
    requirement_set = resolver.resolve(
                      ^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/resolver.py", line 95, in resolve
    result = self._result = resolver.resolve(
                            ^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/resolvelib/resolvers.py", line 546, in resolve
    state = resolution.resolve(requirements, max_rounds=max_rounds)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/resolvelib/resolvers.py", line 427, in resolve
    failure_causes = self._attempt_to_pin_criterion(name)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/resolvelib/resolvers.py", line 239, in _attempt_to_pin_criterion
    criteria = self._get_updated_criteria(candidate)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/resolvelib/resolvers.py", line 230, in _get_updated_criteria
    self._add_to_criteria(criteria, requirement, parent=candidate)
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/resolvelib/resolvers.py", line 173, in _add_to_criteria
    if not criterion.candidates:
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/resolvelib/structs.py", line 156, in __bool__
    return bool(self._sequence)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/found_candidates.py", line 174, in __bool__
    return any(self)
           ^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/found_candidates.py", line 162, in <genexpr>
    return (c for c in iterator if id(c) not in self._incompatible_ids)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/found_candidates.py", line 53, in _iter_built
    candidate = func()
                ^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/factory.py", line 186, in _make_candidate_from_link
    base: Optional[BaseCandidate] = self._make_base_candidate_from_link(
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/factory.py", line 232, in _make_base_candidate_from_link
    self._link_candidate_cache[link] = LinkCandidate(
                                       ^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/candidates.py", line 303, in __init__
    super().__init__(
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/candidates.py", line 158, in __init__
    self.dist = self._prepare()
                ^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/candidates.py", line 235, in _prepare
    dist = self._prepare_distribution()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/candidates.py", line 314, in _prepare_distribution
    return preparer.prepare_linked_requirement(self._ireq, parallel_builds=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/operations/prepare.py", line 527, in prepare_linked_requirement
    return self._prepare_linked_requirement(req, parallel_builds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/operations/prepare.py", line 598, in _prepare_linked_requirement
    local_file = unpack_url(
                 ^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/operations/prepare.py", line 170, in unpack_url
    file = get_http_url(
           ^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/operations/prepare.py", line 111, in get_http_url
    from_path, content_type = download(link, temp_dir.path)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/network/download.py", line 148, in __call__
    for chunk in chunks:
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/cli/progress_bars.py", line 55, in _rich_progress_bar
    for chunk in iterable:
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_internal/network/utils.py", line 65, in response_chunks
    for chunk in response.raw.stream(
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/urllib3/response.py", line 622, in stream
    data = self.read(amt=amt, decode_content=decode_content)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/urllib3/response.py", line 560, in read
    with self._error_catcher():
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/daoyuan_mm/miniconda3/lib/python3.12/site-packages/pip/_vendor/urllib3/response.py", line 443, in _error_catcher
    raise ReadTimeoutError(self._pool, None, "Read timed out.")
pip._vendor.urllib3.exceptions.ReadTimeoutError: HTTPSConnectionPool(host='files.pythonhosted.org', port=443): Read timed out.

Loading remote code successfully: model
2024-12-05 14:53:07.835 | INFO     | data_juicer.core.executor:run:166 - Processing data...
video_audio_speech_ASR_mapper_process:   0%|          | 0/3 [00:00<?, ? examples/s]video_audio_speech_ASR_mapper_process:   0%|          | 0/3 [00:12<?, ? examples/s]video_audio_speech_ASR_mapper_process:   0%|          | 0/3 [00:12<?, ? examples/s]
2024-12-05 14:53:20.539 | ERROR    | data_juicer.core.executor:run:240 - An error occurred during Op [video_audio_speech_ASR_mapper].
Traceback (most recent call last):
  File "/home/daoyuan_mm/data_juicer/data_juicer/core/executor.py", line 181, in run
    tmp = dataset.map(function=op.process,
  File "/home/daoyuan_mm/data_juicer/data_juicer/core/data.py", line 180, in map
    new_ds = NestedDataset(super().map(*args, **kargs))
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/datasets/arrow_dataset.py", line 593, in wrapper
    out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/datasets/arrow_dataset.py", line 558, in wrapper
    out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/datasets/arrow_dataset.py", line 3105, in map
    for rank, done, content in Dataset._map_single(**dataset_kwargs):
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/datasets/arrow_dataset.py", line 3482, in _map_single
    batch = apply_function_on_filtered_inputs(
  File "/home/daoyuan_mm/miniconda3/envs/videollama/lib/python3.9/site-packages/datasets/arrow_dataset.py", line 3361, in apply_function_on_filtered_inputs
    processed_inputs = function(*fn_args, *additional_args, **fn_kwargs)
  File "/home/daoyuan_mm/data_juicer/data_juicer/core/data.py", line 47, in wrapped_f
    return f(*args, **kargs)
  File "/home/daoyuan_mm/data_juicer/data_juicer/core/data.py", line 47, in wrapped_f
    return f(*args, **kargs)
  File "/home/daoyuan_mm/data_juicer/data_juicer/ops/mapper/video_audio_speech_ASR_mapper.py", line 76, in process
    ys, srs, valid_indexes = extract_audio_from_video(
  File "/home/daoyuan_mm/data_juicer/data_juicer/utils/mm_utils.py", line 617, in extract_audio_from_video
    raise ValueError(f'Unsupported type of input_video. Should be one of '
ValueError: Unsupported type of input_video. Should be one of [str, av.container.InputContainer], but given [<class 'list'>].
